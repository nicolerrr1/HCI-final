<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FocusQuest ‚Äî Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header class="nav-wrap">
  <div class="nav-inner">
    <a class="logo" href="index.html" aria-label="FocusQuest home">FOCUSQUEST</a>
    <nav>
      <ul class="nav-list">
        <li><a href="index.html">Home</a></li>
        <li><a href="timer.html">Timer</a></li>
        <li><a href="dashboard.html" class="active">Dashboard</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="dashboard-main desktop-first" role="main">
  <section class="dashboard-left">
    <div class="panel neon-panel">
      <h2>Your Progress</h2>
      <div class="progress-top">
        <div class="level-display">
          <div class="level-big" id="dashLevel">Lvl 1</div>
          <div class="xp-large">XP <span id="dashXP">0</span></div>
        </div>
        <div class="xp-bar large" aria-hidden="true">
          <div id="dashXPFill" class="xp-fill" style="width:0%"></div>
        </div>
        <div class="next-level">Next Level: <span id="dashNext">200</span> XP</div>
      </div>

      <h3>Achievements</h3>
      <div id="badgesWrap" class="badges-grid">
        <!-- badges injected by JS -->
      </div>
    </div>
  </section>

  <aside class="dashboard-right">
    <div class="panel neon-panel">
      <h3>Session History</h3>
      <div class="history">
        <div class="history-item">Sessions Completed: <span id="dashSessions">0</span></div>
        <div class="history-item">Badges Earned: <span id="dashBadges">0</span></div>
      </div>

      <div class="dashboard-actions">
        <button id="resetProgress" class="btn-minimal">Reset Progress</button>
      </div>
    </div>

    <div class="panel neon-panel">
      <h4>How XP & Levels Work</h4>
      <ul class="muted small">
        <li>Each Pomodoro session completed = <strong>50 XP</strong>.</li>
        <li>Levels increase every <strong>200 XP</strong>.</li>
      </ul>
    </div>
  </aside>
</main>

<footer class="site-footer">
  <p>FocusQuest ‚Ä¢ Dashboard</p>
</footer>

<script>
(function(){
  const XP_KEY = 'fq_xp';
  const SESSIONS_KEY = 'fq_sessions';
  const BADGES_KEY = 'fq_badges';

  function loadState() {
    const xp = parseInt(localStorage.getItem(XP_KEY) || '0', 10);
    const sessions = parseInt(localStorage.getItem(SESSIONS_KEY) || '0', 10);
    const badges = JSON.parse(localStorage.getItem(BADGES_KEY) || '[]');
    return { xp, sessions, badges };
  }
  function levelForXP(xp) { return Math.floor(xp / 200) + 1; }
  function nextLevelXP(xp) { return levelForXP(xp) * 200; }

  const dashLevel = document.getElementById('dashLevel');
  const dashXP = document.getElementById('dashXP');
  const dashXPFill = document.getElementById('dashXPFill');
  const dashNext = document.getElementById('dashNext');
  const dashSessions = document.getElementById('dashSessions');
  const dashBadges = document.getElementById('dashBadges');
  const badgesWrap = document.getElementById('badgesWrap');
  const resetBtn = document.getElementById('resetProgress');

  function render() {
    const s = loadState();
    dashLevel.textContent = 'Lvl ' + levelForXP(s.xp);
    dashXP.textContent = s.xp;
    dashNext.textContent = nextLevelXP(s.xp);
    dashSessions.textContent = s.sessions;
    dashBadges.textContent = s.badges.length;
    const percent = Math.min(100, Math.round((s.xp % 200) / 200 * 100));
    dashXPFill.style.width = percent + '%';

    // render badges
    badgesWrap.innerHTML = '';
    if (s.badges.length === 0) {
      const empty = document.createElement('div');
      empty.className = 'muted';
      empty.textContent = 'No achievements yet. Complete Pomodoro sessions to earn badges.';
      badgesWrap.appendChild(empty);
    } else {
      s.badges.forEach((b) => {
        const card = document.createElement('div');
        card.className = 'badge-card';
        card.innerHTML = `<div class="badge-ico">üèÖ</div><div class="badge-meta"><div class="badge-title">${b}</div><div class="badge-sub">Earned</div></div>`;
        badgesWrap.appendChild(card);
      });
    }
  }

  resetBtn.addEventListener('click', () => {
    if (!confirm('Reset local progress? This will clear XP and badges from this browser.')) return;
    localStorage.setItem(XP_KEY, '0');
    localStorage.setItem(SESSIONS_KEY, '0');
    localStorage.setItem(BADGES_KEY, JSON.stringify([]));
    render();
  });

  // update when other tabs change storage
  window.addEventListener('storage', (e) => {
    if ([XP_KEY, SESSIONS_KEY, BADGES_KEY].includes(e.key)) {
      render();
    }
  });
  // custom event
  window.addEventListener('fq_meta_update', render);

  render();
})();
</script>
</body>
</html>
